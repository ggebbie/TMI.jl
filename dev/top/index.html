<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Top-level functions · TMI.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://ggebbie.github.io/TMI.jl/top/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">TMI.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Top-level functions</a></li><li><a class="tocitem" href="../config/">Configuration</a></li><li><a class="tocitem" href="../grid/">Grid</a></li><li><a class="tocitem" href="../boundaries/">Boundary Conditions</a></li><li><a class="tocitem" href="../plots/">Plots</a></li><li><a class="tocitem" href="../utils/">Utilities</a></li><li><a class="tocitem" href="../legacy/">Older functions</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Top-level functions</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Top-level functions</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/ggebbie/TMI.jl/blob/master/docs/src/top.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Top-level-functions"><a class="docs-heading-anchor" href="#Top-level-functions">Top-level functions</a><a id="Top-level-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Top-level-functions" title="Permalink"></a></h1><p>Main functionality for <a href="https://github.com/ggebbie/TMI.jl">TMI</a>.</p><article class="docstring"><header><a class="docstring-binding" id="TMI.trackpathways" href="#TMI.trackpathways"><code>TMI.trackpathways</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">function trackpathways(TMIversion,latbox,lonbox)
Track the pathways of a user-defined water mass.
 Steps: (a) define the water mass by a rectangular surface patch dyed with passive tracer concentration of         (b) propagate the dye with the matrix A, with the result being the fraction of water originating from the surface region.
 See Section 2b of Gebbie &amp; Huybers 2010, esp. eqs. (15)-(17).</code></pre><p><strong>Arguments</strong></p><ul><li><code>TMIversion</code>: version of TMI water-mass/circulation model</li><li><code>latbox</code>: min and max latitude of box</li><li><code>lonbox</code>: min and max longitude of box</li><li><code>γ</code>: TMI grid</li></ul><p><strong>Output</strong></p><ul><li><code>c</code>: fraction of water from surface source</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ggebbie/TMI.jl/blob/fb47e2be9f9282c393aae6a8eb3a52e5cc6bde53/src/TMI.jl#L141-L154">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TMI.watermassdistribution" href="#TMI.watermassdistribution"><code>TMI.watermassdistribution</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">function watermassdistribution(TMIversion,latbox,lonbox)
Track the pathways of a user-defined water mass.
 Steps: (a) define the water mass by an oceanographically-relevant surface patch dyed with passive tracer concentration of one
     (b) propagate the dye with the matrix A, with the result being the fraction of water originating from the surface region.
 See Section 2b of Gebbie &amp; Huybers 2010, esp. eqs. (15)-(17).</code></pre><p><strong>Arguments</strong></p><ul><li><code>TMIversion</code>: version of TMI water-mass/circulation model</li><li><code>Alu</code>: LU decomposition of water-mass matrix A</li><li><code>region</code>: name of pre-defined surface region</li><li><code>γ</code>: TMI grid</li></ul><p><strong>Output</strong></p><ul><li><code>g</code>: water-mass fraction</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ggebbie/TMI.jl/blob/fb47e2be9f9282c393aae6a8eb3a52e5cc6bde53/src/TMI.jl#L162-L176">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TMI.regeneratedphosphate" href="#TMI.regeneratedphosphate"><code>TMI.regeneratedphosphate</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">function regeneratedphosphate(TMIversion,Alu,γ)
Regenerated (i.e., accumulated, remineralized) phosphate</code></pre><p><strong>Arguments</strong></p><ul><li><code>TMIversion</code>: version of TMI water-mass/circulation model</li><li><code>Alu</code>: LU decomposition of water-mass matrix A</li><li><code>γ</code>: TMI grid</li></ul><p><strong>Output</strong></p><ul><li><code>PO₄ᴿ</code>: regenerated phosphate</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ggebbie/TMI.jl/blob/fb47e2be9f9282c393aae6a8eb3a52e5cc6bde53/src/TMI.jl#L192-L202">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TMI.volumefilled" href="#TMI.volumefilled"><code>TMI.volumefilled</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">function volumefilled(TMIversion)
Find the ocean volume that has originated from each surface box.
 This is equivalent to solving a sensitivity problem:
 The total volume is V = vᵀ c , where v is the volume of each box 
 and c is the fraction of volume from a given source which
 satisfies the equation A c = d.                     
 Next, dV/d(d) = A⁻ᵀ v, and dV/d(d) is exactly the volume originating from each source.

 See Section 3 and Supplementary Section 4, Gebbie &amp; Huybers 2011.</code></pre><p><strong>Arguments</strong></p><ul><li><code>TMIversion</code>: version of TMI water-mass/circulation model</li><li><code>Alu</code>: LU decomposition of water-mass matrix A</li><li><code>γ</code>: TMI.grid</li></ul><p><strong>Output</strong></p><ul><li><code>volume</code>: log10 of global ocean volume filled by a surface region, exists at surface, therefore given BoundaryCondition type</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ggebbie/TMI.jl/blob/fb47e2be9f9282c393aae6a8eb3a52e5cc6bde53/src/TMI.jl#L254-L271">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TMI.surfaceorigin" href="#TMI.surfaceorigin"><code>TMI.surfaceorigin</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">function surfaceorigin(TMIversion,loc)
 Find the surface origin of water for some interior box 
 This is equivalent to solving a sensitivity problem:
 The mass fraction at a location `loc` of interest is 
`c[loc] = δᵀ c`, where `δ` samples the location of the global mass-fraction variable, c.
Then the sensitivity of `c[loc]` is: d(c[loc])/d(d) = A⁻ᵀ δ.
The derivative is solved using the constraint: Ac = d.
The sensitivity is exactly the mass fraction originating from each source.      
This problem is mathematically similar to determining how the ocean is filled.</code></pre><p><strong>Arguments</strong></p><ul><li><code>loc</code>: location (lon,lat,depth) of location of interest</li><li><code>Alu</code>: LU decomposition of water-mass matrix A</li><li><code>γ</code>: TMI grid</li></ul><p><strong>Output</strong></p><ul><li><code>origin</code>: surface map of fraction of source water for a given location, log10 of effective depth, in terms of a BoundaryCondition</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ggebbie/TMI.jl/blob/fb47e2be9f9282c393aae6a8eb3a52e5cc6bde53/src/TMI.jl#L294-L311">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TMI.meanage" href="#TMI.meanage"><code>TMI.meanage</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">function meanage(TMIversion,Alu,γ)
Mean or ideal age</code></pre><p><strong>Arguments</strong></p><ul><li><code>TMIversion</code>: version of TMI water-mass/circulation model</li><li><code>Alu</code>: LU decomposition of water-mass matrix A</li><li><code>γ</code>: TMI grid</li></ul><p><strong>Output</strong></p><ul><li><code>a</code>: mean age [yr]</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ggebbie/TMI.jl/blob/fb47e2be9f9282c393aae6a8eb3a52e5cc6bde53/src/TMI.jl#L216-L226">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TMI.sparsedatamap" href="#TMI.sparsedatamap"><code>TMI.sparsedatamap</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">function sparsedatamap(u₀::Vector{T},Alu,b::BoundaryCondition{T},u::BoundaryCondition{T},y::Vector{T},W⁻,wis,locs,Q⁻,γ::Grid;iterations=10) where T &lt;: Real

 Find the distribution of a tracer given:
 (a) the pathways described by A or its LU decomposition Alu,
 (b) first-guess boundary conditions and interior sources given by d₀,
 (c) perturbations to the surface boundary condition u₀
that best fits observations, y,
according to the cost function,
J = (ỹ - y)ᵀ W⁻¹ (ỹ - y)
subject to Aỹ = d₀ + Γ u₀.                 
W⁻ is a (sparse) weighting matrix.
See Supplementary Section 2, Gebbie &amp; Huybers 2011.</code></pre><p><strong>Arguments</strong></p><ul><li><code>u₀</code>:</li><li><code>Alu</code>:</li><li><code>b</code>: first guess of boundary conditions and interior sources</li><li><code>y</code>: observations on 3D grid</li><li><code>W⁻</code>: weighting matrix best chosen as inverse error covariance matrix</li><li><code>fg!</code>: compute cost function and gradient in place</li><li><code>γ</code>: grid</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ggebbie/TMI.jl/blob/fb47e2be9f9282c393aae6a8eb3a52e5cc6bde53/src/TMI.jl#L362-L383">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="TMI.steadyclimatology" href="#TMI.steadyclimatology"><code>TMI.steadyclimatology</code></a> — <span class="docstring-category">Function</span></header><section><div><p>function steadyclimatology(u₀,fg!,iterations)      Find the distribution of a tracer given:      (a) the pathways described by A or its LU decomposition Alu,      (b) first-guess boundary conditions and interior sources given by d₀,      (c) perturbations to the surface boundary condition u₀     that best fits observations, y,     according to the cost function,     J = (ỹ - y)ᵀ W⁻¹ (ỹ - y)     subject to Aỹ = d₀ + Γ u₀.                      W⁻ is a (sparse) weighting matrix.     See Supplementary Section 2, Gebbie &amp; Huybers 2011.</p><p><strong>Arguments</strong></p><ul><li><code>u₀</code>:</li><li><code>fg!</code>: compute cost function and gradient in place</li><li><code>iterations</code>: number of optimization iterations</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/ggebbie/TMI.jl/blob/fb47e2be9f9282c393aae6a8eb3a52e5cc6bde53/src/TMI.jl#L333-L349">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../config/">Configuration »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.5 on <span class="colophon-date" title="Monday 23 May 2022 18:44">Monday 23 May 2022</span>. Using Julia version 1.7.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
